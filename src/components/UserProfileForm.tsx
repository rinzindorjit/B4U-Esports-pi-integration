'use client'
import { useState } from 'react'
import { useAuth } from '../hooks/useAuth'
import { UserProfileData, PubgProfileData, MlbbProfileData } from '../types'

interface UserProfileFormProps {
  isOpen: boolean
  onClose: () => void
  onComplete: () => void
}

export default function UserProfileForm({ isOpen, onClose, onComplete }: UserProfileFormProps) {
  const { user, updateProfile } = useAuth()
  const [isLoading, setIsLoading] = useState(false)
  const [currentStep, setCurrentStep] = useState(1)
  const [selectedGames, setSelectedGames] = useState<('PUBG_MOBILE' | 'MLBB')[]>([])
  const [errors, setErrors] = useState<Record<string, string>>({})

  // Form data
  const [profileData, setProfileData] = useState<UserProfileData>({
    email: '', // Leave email blank for users to fill
    contactNumber: user?.contactNumber || '',
    country: user?.country || 'BT', // Default to Bhutan
    language: user?.language || 'en',
    referralCode: user?.referralCode || ''
  })

  const [pubgData, setPubgData] = useState<PubgProfileData>({
    ign: user?.pubgProfile?.ign || '',
    uid: user?.pubgProfile?.uid || ''
  })

  const [mlbbData, setMlbbData] = useState<MlbbProfileData>({
    userId_game: user?.mlbbProfile?.userId_game || '',
    zoneId: user?.mlbbProfile?.zoneId || ''
  })

  if (!isOpen) return null

  const validateStep1 = () => {
    const newErrors: Record<string, string> = {}
    
    if (!profileData.email) {
      newErrors.email = 'Email is required'
    } else if (!/\S+@\S+\.\S+/.test(profileData.email)) {
      newErrors.email = 'Please enter a valid email'
    }
    
    if (!profileData.country) {
      newErrors.country = 'Country is required'
    }

    setErrors(newErrors)
    return Object.keys(newErrors).length === 0
  }

  const validatePubg = () => {
    const newErrors: Record<string, string> = {}
    
    if (!pubgData.ign.trim()) {
      newErrors.pubgIgn = 'IGN (In-Game Name) is required'
    }
    
    if (!pubgData.uid.trim()) {
      newErrors.pubgUid = 'UID is required'
    } else if (!/^\d+$/.test(pubgData.uid)) {
      newErrors.pubgUid = 'UID must contain only numbers'
    }

    setErrors(newErrors)
    return Object.keys(newErrors).length === 0
  }

  const validateMlbb = () => {
    const newErrors: Record<string, string> = {}
    
    if (!mlbbData.userId_game.trim()) {
      newErrors.mlbbUserId = 'User ID is required'
    } else if (!/^\d+$/.test(mlbbData.userId_game)) {
      newErrors.mlbbUserId = 'User ID must contain only numbers'
    }
    
    if (!mlbbData.zoneId.trim()) {
      newErrors.mlbbZoneId = 'Zone ID is required'
    } else if (!/^\d+$/.test(mlbbData.zoneId)) {
      newErrors.mlbbZoneId = 'Zone ID must contain only numbers'
    }

    setErrors(newErrors)
    return Object.keys(newErrors).length === 0
  }

  const handleNext = () => {
    if (currentStep === 1 && validateStep1()) {
      setCurrentStep(2)
    } else if (currentStep === 2 && selectedGames.length > 0) {
      // Move to the first selected game profile
      if (selectedGames.includes('PUBG_MOBILE')) {
        setCurrentStep(3) // PUBG profile step
      } else if (selectedGames.includes('MLBB')) {
        setCurrentStep(4) // MLBB profile step
      }
    } else if (currentStep === 3 && selectedGames.includes('MLBB')) {
      // If both games selected and coming from PUBG, go to MLBB
      setCurrentStep(4)
    }
  }

  const handleBack = () => {
    if (currentStep === 4 && selectedGames.includes('PUBG_MOBILE')) {
      // If both games selected and on MLBB step, go back to PUBG
      setCurrentStep(3)
    } else if (currentStep === 3 || currentStep === 4) {
      // From any game profile step, go back to game selection
      setCurrentStep(2)
    } else if (currentStep > 1) {
      setCurrentStep(currentStep - 1)
    }
  }

  const handleSubmit = async () => {
    let isValid = true
    
    // Validate selected game profiles
    if (selectedGames.includes('PUBG_MOBILE') && currentStep === 3) {
      isValid = validatePubg()
    } else if (selectedGames.includes('MLBB') && currentStep === 4) {
      isValid = validateMlbb()
    }

    if (!isValid) return

    setIsLoading(true)
    try {
      const response = await fetch('/api/user/profile', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          profileData,
          pubgData: selectedGames.includes('PUBG_MOBILE') ? pubgData : null,
          mlbbData: selectedGames.includes('MLBB') ? mlbbData : null
        })
      })

      if (!response.ok) {
        throw new Error('Failed to update profile')
      }

      const result = await response.json()
      updateProfile(result.user)
      onComplete()
      onClose()

    } catch (error) {
      console.error('Profile update failed:', error)
      alert('Failed to update profile. Please try again.')
    } finally {
      setIsLoading(false)
    }
  }

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-3 sm:p-4">
      <div className="bg-gradient-to-br from-white via-blue-50 to-purple-50 rounded-xl max-w-md w-full max-h-[90vh] overflow-y-auto mx-auto shadow-2xl border border-white/20">
        <div className="p-4 sm:p-6">
          {/* Header */}
          <div className="flex items-center justify-between mb-4 sm:mb-6">
            <h2 className="text-lg sm:text-xl font-bold bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 bg-clip-text text-transparent">Complete Your Profile</h2>
            <button onClick={onClose} className="text-gray-400 hover:text-red-500 text-2xl sm:text-3xl p-1 touch-manipulation transition-colors duration-300 hover:scale-110 transform">Ã—</button>
          </div>

          {/* Progress */}
          <div className="mb-4 sm:mb-6">
            <div className="flex space-x-1 sm:space-x-2">
              {[1, 2, 3, 4].map((step) => {
                let isActive = step <= currentStep
                // Hide unused steps based on game selection
                if (step === 3 && !selectedGames.includes('PUBG_MOBILE')) isActive = false
                if (step === 4 && !selectedGames.includes('MLBB')) isActive = false
                
                return (
                  <div
                    key={step}
                    className={`flex-1 h-3 rounded-full transition-all duration-500 ${
                      isActive
                        ? 'bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 shadow-lg' 
                        : 'bg-gray-200 hover:bg-gray-300'
                    } ${
                      (step === 3 && !selectedGames.includes('PUBG_MOBILE')) || 
                      (step === 4 && !selectedGames.includes('MLBB')) 
                        ? 'opacity-30' : ''
                    }`}
                  />
                )
              })}
            </div>
            <div className="flex justify-between text-xs mt-2">
              <span className={`transition-colors duration-300 ${
                currentStep >= 1 ? 'text-blue-600 font-semibold' : 'text-gray-500'
              }`}>Basic Info</span>
              <span className={`transition-colors duration-300 ${
                currentStep >= 2 ? 'text-purple-600 font-semibold' : 'text-gray-500'
              }`}>Select Games</span>
              <span className={`transition-colors duration-300 ${
                currentStep >= 3 && selectedGames.includes('PUBG_MOBILE') ? 'text-orange-600 font-semibold' : 'text-gray-500'
              } ${!selectedGames.includes('PUBG_MOBILE') ? 'opacity-50' : ''}`}>PUBG Profile</span>
              <span className={`transition-colors duration-300 ${
                currentStep >= 4 && selectedGames.includes('MLBB') ? 'text-pink-600 font-semibold' : 'text-gray-500'
              } ${!selectedGames.includes('MLBB') ? 'opacity-50' : ''}`}>MLBB Profile</span>
            </div>
          </div>

          {/* Step 1: Basic Information */}
          {currentStep === 1 && (
            <div className="space-y-3 sm:space-y-4">
              <h3 className="font-semibold mb-3 sm:mb-4 text-base sm:text-lg bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">Basic Information</h3>
              
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  Email Address *
                </label>
                <input
                  type="email"
                  value={profileData.email}
                  onChange={(e) => setProfileData({...profileData, email: e.target.value})}
                  className="w-full px-3 py-2.5 sm:py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base touch-manipulation bg-gradient-to-r from-blue-50 to-purple-50 hover:from-blue-100 hover:to-purple-100 transition-all duration-300"
                  placeholder="your@email.com"
                />
                {errors.email && <p className="text-red-500 text-sm mt-1">{errors.email}</p>}
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  Contact Number
                </label>
                <input
                  type="tel"
                  value={profileData.contactNumber}
                  onChange={(e) => setProfileData({...profileData, contactNumber: e.target.value})}
                  className="w-full px-3 py-2.5 sm:py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base touch-manipulation bg-gradient-to-r from-green-50 to-blue-50 hover:from-green-100 hover:to-blue-100 transition-all duration-300"
                  placeholder="+1234567890"
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  Country *
                </label>
                <select
                  value={profileData.country}
                  onChange={(e) => setProfileData({...profileData, country: e.target.value})}
                  className="w-full px-3 py-2.5 sm:py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base touch-manipulation bg-gradient-to-r from-blue-50 to-purple-50 hover:from-blue-100 hover:to-purple-100 transition-all duration-300"
                >
                  <option value="">Select Country</option>
                  <option value="BT">ðŸ‡§ðŸ‡¹ Bhutan</option>
                  <option value="AF">ðŸ‡¦ðŸ‡« Afghanistan</option>
                  <option value="AL">ðŸ‡¦ðŸ‡± Albania</option>
                  <option value="DZ">ðŸ‡©ðŸ‡¿ Algeria</option>
                  <option value="AS">ðŸ‡¦ðŸ‡¸ American Samoa</option>
                  <option value="AD">ðŸ‡¦ðŸ‡© Andorra</option>
                  <option value="AO">ðŸ‡¦ðŸ‡´ Angola</option>
                  <option value="AI">ðŸ‡¦ðŸ‡® Anguilla</option>
                  <option value="AQ">ðŸ‡¦ðŸ‡¶ Antarctica</option>
                  <option value="AG">ðŸ‡¦ðŸ‡¬ Antigua and Barbuda</option>
                  <option value="AR">ðŸ‡¦ðŸ‡· Argentina</option>
                  <option value="AM">ðŸ‡¦ðŸ‡² Armenia</option>
                  <option value="AW">ðŸ‡¦ðŸ‡¼ Aruba</option>
                  <option value="AU">ðŸ‡¦ðŸ‡º Australia</option>
                  <option value="AT">ðŸ‡¦ðŸ‡¹ Austria</option>
                  <option value="AZ">ðŸ‡¦ðŸ‡¿ Azerbaijan</option>
                  <option value="BS">ðŸ‡§ðŸ‡¸ Bahamas</option>
                  <option value="BH">ðŸ‡§ðŸ‡­ Bahrain</option>
                  <option value="BD">ðŸ‡§ðŸ‡© Bangladesh</option>
                  <option value="BB">ðŸ‡§ðŸ‡§ Barbados</option>
                  <option value="BY">ðŸ‡§ðŸ‡¾ Belarus</option>
                  <option value="BE">ðŸ‡§ðŸ‡ª Belgium</option>
                  <option value="BZ">ðŸ‡§ðŸ‡¿ Belize</option>
                  <option value="BJ">ðŸ‡§ðŸ‡¯ Benin</option>
                  <option value="BM">ðŸ‡§ðŸ‡² Bermuda</option>
                  <option value="BO">ðŸ‡§ðŸ‡´ Bolivia</option>
                  <option value="BA">ðŸ‡§ðŸ‡¦ Bosnia and Herzegovina</option>
                  <option value="BW">ðŸ‡§ðŸ‡¼ Botswana</option>
                  <option value="BR">ðŸ‡§ðŸ‡· Brazil</option>
                  <option value="BN">ðŸ‡§ðŸ‡³ Brunei</option>
                  <option value="BG">ðŸ‡§ðŸ‡¬ Bulgaria</option>
                  <option value="BF">ðŸ‡§ðŸ‡« Burkina Faso</option>
                  <option value="BI">ðŸ‡§ðŸ‡® Burundi</option>
                  <option value="CV">ðŸ‡¨ðŸ‡» Cape Verde</option>
                  <option value="KH">ðŸ‡°ðŸ‡­ Cambodia</option>
                  <option value="CM">ðŸ‡¨ðŸ‡² Cameroon</option>
                  <option value="CA">ðŸ‡¨ðŸ‡¦ Canada</option>
                  <option value="KY">ðŸ‡°ðŸ‡¾ Cayman Islands</option>
                  <option value="CF">ðŸ‡¨ðŸ‡« Central African Republic</option>
                  <option value="TD">ðŸ‡¹ðŸ‡© Chad</option>
                  <option value="CL">ðŸ‡¨ðŸ‡± Chile</option>
                  <option value="CN">ðŸ‡¨ðŸ‡³ China</option>
                  <option value="CO">ðŸ‡¨ðŸ‡´ Colombia</option>
                  <option value="KM">ðŸ‡°ðŸ‡² Comoros</option>
                  <option value="CG">ðŸ‡¨ðŸ‡¬ Congo</option>
                  <option value="CD">ðŸ‡¨ðŸ‡© Congo (Democratic Republic)</option>
                  <option value="CK">ðŸ‡¨ðŸ‡° Cook Islands</option>
                  <option value="CR">ðŸ‡¨ðŸ‡· Costa Rica</option>
                  <option value="CI">ðŸ‡¨ðŸ‡® CÃ´te d'Ivoire</option>
                  <option value="HR">ðŸ‡­ðŸ‡· Croatia</option>
                  <option value="CU">ðŸ‡¨ðŸ‡º Cuba</option>
                  <option value="CW">ðŸ‡¨ðŸ‡¼ CuraÃ§ao</option>
                  <option value="CY">ðŸ‡¨ðŸ‡¾ Cyprus</option>
                  <option value="CZ">ðŸ‡¨ðŸ‡¿ Czech Republic</option>
                  <option value="DK">ðŸ‡©ðŸ‡° Denmark</option>
                  <option value="DJ">ðŸ‡©ðŸ‡¯ Djibouti</option>
                  <option value="DM">ðŸ‡©ðŸ‡² Dominica</option>
                  <option value="DO">ðŸ‡©ðŸ‡´ Dominican Republic</option>
                  <option value="EC">ðŸ‡ªðŸ‡¨ Ecuador</option>
                  <option value="EG">ðŸ‡ªðŸ‡¬ Egypt</option>
                  <option value="SV">ðŸ‡¸ðŸ‡» El Salvador</option>
                  <option value="GQ">ðŸ‡¬ðŸ‡¶ Equatorial Guinea</option>
                  <option value="ER">ðŸ‡ªðŸ‡· Eritrea</option>
                  <option value="EE">ðŸ‡ªðŸ‡ª Estonia</option>
                  <option value="SZ">ðŸ‡¸ðŸ‡¿ Eswatini</option>
                  <option value="ET">ðŸ‡ªðŸ‡¹ Ethiopia</option>
                  <option value="FK">ðŸ‡«ðŸ‡° Falkland Islands</option>
                  <option value="FO">ðŸ‡«ðŸ‡´ Faroe Islands</option>
                  <option value="FJ">ðŸ‡«ðŸ‡¯ Fiji</option>
                  <option value="FI">ðŸ‡«ðŸ‡® Finland</option>
                  <option value="FR">ðŸ‡«ðŸ‡· France</option>
                  <option value="GF">ðŸ‡¬ðŸ‡« French Guiana</option>
                  <option value="PF">ðŸ‡µðŸ‡« French Polynesia</option>
                  <option value="GA">ðŸ‡¬ðŸ‡¦ Gabon</option>
                  <option value="GM">ðŸ‡¬ðŸ‡² Gambia</option>
                  <option value="GE">ðŸ‡¬ðŸ‡ª Georgia</option>
                  <option value="DE">ðŸ‡©ðŸ‡ª Germany</option>
                  <option value="GH">ðŸ‡¬ðŸ‡­ Ghana</option>
                  <option value="GI">ðŸ‡¬ðŸ‡® Gibraltar</option>
                  <option value="GR">ðŸ‡¬ðŸ‡· Greece</option>
                  <option value="GL">ðŸ‡¬ðŸ‡± Greenland</option>
                  <option value="GD">ðŸ‡¬ðŸ‡© Grenada</option>
                  <option value="GP">ðŸ‡¬ðŸ‡µ Guadeloupe</option>
                  <option value="GU">ðŸ‡¬ðŸ‡º Guam</option>
                  <option value="GT">ðŸ‡¬ðŸ‡¹ Guatemala</option>
                  <option value="GG">ðŸ‡¬ðŸ‡¬ Guernsey</option>
                  <option value="GN">ðŸ‡¬ðŸ‡³ Guinea</option>
                  <option value="GW">ðŸ‡¬ðŸ‡¼ Guinea-Bissau</option>
                  <option value="GY">ðŸ‡¬ðŸ‡¾ Guyana</option>
                  <option value="HT">ðŸ‡­ðŸ‡¹ Haiti</option>
                  <option value="HN">ðŸ‡­ðŸ‡³ Honduras</option>
                  <option value="HK">ðŸ‡­ðŸ‡° Hong Kong</option>
                  <option value="HU">ðŸ‡­ðŸ‡º Hungary</option>
                  <option value="IS">ðŸ‡®ðŸ‡¸ Iceland</option>
                  <option value="IN">ðŸ‡®ðŸ‡³ India</option>
                  <option value="ID">ðŸ‡®ðŸ‡© Indonesia</option>
                  <option value="IR">ðŸ‡®ðŸ‡· Iran</option>
                  <option value="IQ">ðŸ‡®ðŸ‡¶ Iraq</option>
                  <option value="IE">ðŸ‡®ðŸ‡ª Ireland</option>
                  <option value="IM">ðŸ‡®ðŸ‡² Isle of Man</option>
                  <option value="IL">ðŸ‡®ðŸ‡± Israel</option>
                  <option value="IT">ðŸ‡®ðŸ‡¹ Italy</option>
                  <option value="JM">ðŸ‡¯ðŸ‡² Jamaica</option>
                  <option value="JP">ðŸ‡¯ðŸ‡µ Japan</option>
                  <option value="JE">ðŸ‡¯ðŸ‡ª Jersey</option>
                  <option value="JO">ðŸ‡¯ðŸ‡´ Jordan</option>
                  <option value="KZ">ðŸ‡°ðŸ‡¿ Kazakhstan</option>
                  <option value="KE">ðŸ‡°ðŸ‡ª Kenya</option>
                  <option value="KI">ðŸ‡°ðŸ‡® Kiribati</option>
                  <option value="KP">ðŸ‡°ðŸ‡µ Korea (North)</option>
                  <option value="KR">ðŸ‡°ðŸ‡· Korea (South)</option>
                  <option value="KW">ðŸ‡°ðŸ‡¼ Kuwait</option>
                  <option value="KG">ðŸ‡°ðŸ‡¬ Kyrgyzstan</option>
                  <option value="LA">ðŸ‡±ðŸ‡¦ Laos</option>
                  <option value="LV">ðŸ‡±ðŸ‡» Latvia</option>
                  <option value="LB">ðŸ‡±ðŸ‡§ Lebanon</option>
                  <option value="LS">ðŸ‡±ðŸ‡¸ Lesotho</option>
                  <option value="LR">ðŸ‡±ðŸ‡· Liberia</option>
                  <option value="LY">ðŸ‡±ðŸ‡¾ Libya</option>
                  <option value="LI">ðŸ‡±ðŸ‡® Liechtenstein</option>
                  <option value="LT">ðŸ‡±ðŸ‡¹ Lithuania</option>
                  <option value="LU">ðŸ‡±ðŸ‡º Luxembourg</option>
                  <option value="MO">ðŸ‡²ðŸ‡´ Macao</option>
                  <option value="MG">ðŸ‡²ðŸ‡¬ Madagascar</option>
                  <option value="MW">ðŸ‡²ðŸ‡¼ Malawi</option>
                  <option value="MY">ðŸ‡²ðŸ‡¾ Malaysia</option>
                  <option value="MV">ðŸ‡²ðŸ‡» Maldives</option>
                  <option value="ML">ðŸ‡²ðŸ‡± Mali</option>
                  <option value="MT">ðŸ‡²ðŸ‡¹ Malta</option>
                  <option value="MH">ðŸ‡²ðŸ‡­ Marshall Islands</option>
                  <option value="MQ">ðŸ‡²ðŸ‡¶ Martinique</option>
                  <option value="MR">ðŸ‡²ðŸ‡· Mauritania</option>
                  <option value="MU">ðŸ‡²ðŸ‡º Mauritius</option>
                  <option value="YT">ðŸ‡¾ðŸ‡¹ Mayotte</option>
                  <option value="MX">ðŸ‡²ðŸ‡½ Mexico</option>
                  <option value="FM">ðŸ‡«ðŸ‡² Micronesia</option>
                  <option value="MD">ðŸ‡²ðŸ‡© Moldova</option>
                  <option value="MC">ðŸ‡²ðŸ‡¨ Monaco</option>
                  <option value="MN">ðŸ‡²ðŸ‡³ Mongolia</option>
                  <option value="ME">ðŸ‡²ðŸ‡ª Montenegro</option>
                  <option value="MS">ðŸ‡²ðŸ‡¸ Montserrat</option>
                  <option value="MA">ðŸ‡²ðŸ‡¦ Morocco</option>
                  <option value="MZ">ðŸ‡²ðŸ‡¿ Mozambique</option>
                  <option value="MM">ðŸ‡²ðŸ‡² Myanmar</option>
                  <option value="NA">ðŸ‡³ðŸ‡¦ Namibia</option>
                  <option value="NR">ðŸ‡³ðŸ‡· Nauru</option>
                  <option value="NP">ðŸ‡³ðŸ‡µ Nepal</option>
                  <option value="NL">ðŸ‡³ðŸ‡± Netherlands</option>
                  <option value="NC">ðŸ‡³ðŸ‡¨ New Caledonia</option>
                  <option value="NZ">ðŸ‡³ðŸ‡¿ New Zealand</option>
                  <option value="NI">ðŸ‡³ðŸ‡® Nicaragua</option>
                  <option value="NE">ðŸ‡³ðŸ‡ª Niger</option>
                  <option value="NG">ðŸ‡³ðŸ‡¬ Nigeria</option>
                  <option value="NU">ðŸ‡³ðŸ‡º Niue</option>
                  <option value="NF">ðŸ‡³ðŸ‡« Norfolk Island</option>
                  <option value="MK">ðŸ‡²ðŸ‡° North Macedonia</option>
                  <option value="MP">ðŸ‡²ðŸ‡µ Northern Mariana Islands</option>
                  <option value="NO">ðŸ‡³ðŸ‡´ Norway</option>
                  <option value="OM">ðŸ‡´ðŸ‡² Oman</option>
                  <option value="PK">ðŸ‡µðŸ‡° Pakistan</option>
                  <option value="PW">ðŸ‡µðŸ‡¼ Palau</option>
                  <option value="PS">ðŸ‡µðŸ‡¸ Palestine</option>
                  <option value="PA">ðŸ‡µðŸ‡¦ Panama</option>
                  <option value="PG">ðŸ‡µðŸ‡¬ Papua New Guinea</option>
                  <option value="PY">ðŸ‡µðŸ‡¾ Paraguay</option>
                  <option value="PE">ðŸ‡µðŸ‡ª Peru</option>
                  <option value="PH">ðŸ‡µðŸ‡­ Philippines</option>
                  <option value="PN">ðŸ‡µðŸ‡³ Pitcairn</option>
                  <option value="PL">ðŸ‡µðŸ‡± Poland</option>
                  <option value="PT">ðŸ‡µðŸ‡¹ Portugal</option>
                  <option value="PR">ðŸ‡µðŸ‡· Puerto Rico</option>
                  <option value="QA">ðŸ‡¶ðŸ‡¦ Qatar</option>
                  <option value="RE">ðŸ‡·ðŸ‡ª RÃ©union</option>
                  <option value="RO">ðŸ‡·ðŸ‡´ Romania</option>
                  <option value="RU">ðŸ‡·ðŸ‡º Russia</option>
                  <option value="RW">ðŸ‡·ðŸ‡¼ Rwanda</option>
                  <option value="BL">ðŸ‡§ðŸ‡± Saint BarthÃ©lemy</option>
                  <option value="SH">ðŸ‡¸ðŸ‡­ Saint Helena</option>
                  <option value="KN">ðŸ‡°ðŸ‡³ Saint Kitts and Nevis</option>
                  <option value="LC">ðŸ‡±ðŸ‡¨ Saint Lucia</option>
                  <option value="MF">ðŸ‡²ðŸ‡« Saint Martin</option>
                  <option value="PM">ðŸ‡µðŸ‡² Saint Pierre and Miquelon</option>
                  <option value="VC">ðŸ‡»ðŸ‡¨ Saint Vincent and the Grenadines</option>
                  <option value="WS">ðŸ‡¼ðŸ‡¸ Samoa</option>
                  <option value="SM">ðŸ‡¸ðŸ‡² San Marino</option>
                  <option value="ST">ðŸ‡¸ðŸ‡¹ SÃ£o TomÃ© and PrÃ­ncipe</option>
                  <option value="SA">ðŸ‡¸ðŸ‡¦ Saudi Arabia</option>
                  <option value="SN">ðŸ‡¸ðŸ‡³ Senegal</option>
                  <option value="RS">ðŸ‡·ðŸ‡¸ Serbia</option>
                  <option value="SC">ðŸ‡¸ðŸ‡¨ Seychelles</option>
                  <option value="SL">ðŸ‡¸ðŸ‡± Sierra Leone</option>
                  <option value="SG">ðŸ‡¸ðŸ‡¬ Singapore</option>
                  <option value="SX">ðŸ‡¸ðŸ‡½ Sint Maarten</option>
                  <option value="SK">ðŸ‡¸ðŸ‡° Slovakia</option>
                  <option value="SI">ðŸ‡¸ðŸ‡® Slovenia</option>
                  <option value="SB">ðŸ‡¸ðŸ‡§ Solomon Islands</option>
                  <option value="SO">ðŸ‡¸ðŸ‡´ Somalia</option>
                  <option value="ZA">ðŸ‡¿ðŸ‡¦ South Africa</option>
                  <option value="GS">ðŸ‡¬ðŸ‡¸ South Georgia and the South Sandwich Islands</option>
                  <option value="SS">ðŸ‡¸ðŸ‡¸ South Sudan</option>
                  <option value="ES">ðŸ‡ªðŸ‡¸ Spain</option>
                  <option value="LK">ðŸ‡±ðŸ‡° Sri Lanka</option>
                  <option value="SD">ðŸ‡¸ðŸ‡© Sudan</option>
                  <option value="SR">ðŸ‡¸ðŸ‡· Suriname</option>
                  <option value="SJ">ðŸ‡¸ðŸ‡¯ Svalbard and Jan Mayen</option>
                  <option value="SE">ðŸ‡¸ðŸ‡ª Sweden</option>
                  <option value="CH">ðŸ‡¨ðŸ‡­ Switzerland</option>
                  <option value="SY">ðŸ‡¸ðŸ‡¾ Syria</option>
                  <option value="TW">ðŸ‡¹ðŸ‡¼ Taiwan</option>
                  <option value="TJ">ðŸ‡¹ðŸ‡¯ Tajikistan</option>
                  <option value="TZ">ðŸ‡¹ðŸ‡¿ Tanzania</option>
                  <option value="TH">ðŸ‡¹ðŸ‡­ Thailand</option>
                  <option value="TL">ðŸ‡¹ðŸ‡± Timor-Leste</option>
                  <option value="TG">ðŸ‡¹ðŸ‡¬ Togo</option>
                  <option value="TK">ðŸ‡¹ðŸ‡° Tokelau</option>
                  <option value="TO">ðŸ‡¹ðŸ‡´ Tonga</option>
                  <option value="TT">ðŸ‡¹ðŸ‡¹ Trinidad and Tobago</option>
                  <option value="TN">ðŸ‡¹ðŸ‡³ Tunisia</option>
                  <option value="TR">ðŸ‡¹ðŸ‡· Turkey</option>
                  <option value="TM">ðŸ‡¹ðŸ‡² Turkmenistan</option>
                  <option value="TC">ðŸ‡¹ðŸ‡¨ Turks and Caicos Islands</option>
                  <option value="TV">ðŸ‡¹ðŸ‡» Tuvalu</option>
                  <option value="UG">ðŸ‡ºðŸ‡¬ Uganda</option>
                  <option value="UA">ðŸ‡ºðŸ‡¦ Ukraine</option>
                  <option value="AE">ðŸ‡¦ðŸ‡ª United Arab Emirates</option>
                  <option value="GB">ðŸ‡¬ðŸ‡§ United Kingdom</option>
                  <option value="US">ðŸ‡ºðŸ‡¸ United States</option>
                  <option value="UM">ðŸ‡ºðŸ‡² United States Minor Outlying Islands</option>
                  <option value="UY">ðŸ‡ºðŸ‡¾ Uruguay</option>
                  <option value="UZ">ðŸ‡ºðŸ‡¿ Uzbekistan</option>
                  <option value="VU">ðŸ‡»ðŸ‡º Vanuatu</option>
                  <option value="VA">ðŸ‡»ðŸ‡¦ Vatican City</option>
                  <option value="VE">ðŸ‡»ðŸ‡ª Venezuela</option>
                  <option value="VN">ðŸ‡»ðŸ‡³ Vietnam</option>
                  <option value="VG">ðŸ‡»ðŸ‡¬ Virgin Islands (British)</option>
                  <option value="VI">ðŸ‡»ðŸ‡® Virgin Islands (U.S.)</option>
                  <option value="WF">ðŸ‡¼ðŸ‡« Wallis and Futuna</option>
                  <option value="EH">ðŸ‡ªðŸ‡­ Western Sahara</option>
                  <option value="YE">ðŸ‡¾ðŸ‡ª Yemen</option>
                  <option value="ZM">ðŸ‡¿ðŸ‡² Zambia</option>
                  <option value="ZW">ðŸ‡¿ðŸ‡¼ Zimbabwe</option>
                </select>
                {errors.country && <p className="text-red-500 text-sm mt-1">{errors.country}</p>}
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  Referral Code (Optional)
                </label>
                <input
                  type="text"
                  value={profileData.referralCode}
                  onChange={(e) => setProfileData({...profileData, referralCode: e.target.value})}
                  className="w-full px-3 py-2.5 sm:py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base touch-manipulation"
                  placeholder="Enter referral code"
                />
              </div>
            </div>
          )}

          {/* Step 2: Game Selection */}
          {currentStep === 2 && (
            <div className="space-y-4 sm:space-y-6">
              <h3 className="font-semibold mb-3 sm:mb-4 text-base sm:text-lg bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">Choose Your Games</h3>
              <p className="text-sm text-gray-600 mb-4">
                Select the games you play to complete your profile for those specific packages. You can choose one or both!
              </p>
              
              <div className="space-y-3">
                {/* PUBG Mobile Option */}
                <div 
                  onClick={() => {
                    if (selectedGames.includes('PUBG_MOBILE')) {
                      setSelectedGames(selectedGames.filter(game => game !== 'PUBG_MOBILE'))
                    } else {
                      setSelectedGames([...selectedGames, 'PUBG_MOBILE'])
                    }
                  }}
                  className={`cursor-pointer border-2 rounded-xl p-4 transition-all duration-300 hover:shadow-lg transform hover:scale-105 ${
                    selectedGames.includes('PUBG_MOBILE') 
                      ? 'border-orange-500 bg-gradient-to-r from-orange-50 to-red-50 shadow-lg scale-105' 
                      : 'border-gray-200 hover:border-orange-300 bg-white hover:shadow-md'
                  }`}
                >
                  <div className="flex items-center space-x-3">
                    <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all duration-300 ${
                      selectedGames.includes('PUBG_MOBILE') 
                        ? 'border-orange-500 bg-gradient-to-r from-orange-500 to-red-500 shadow-lg' 
                        : 'border-gray-300 hover:border-orange-400'
                    }`}>
                      {selectedGames.includes('PUBG_MOBILE') && (
                        <svg className="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                          <path fillRule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clipRule="evenodd" />
                        </svg>
                      )}
                    </div>
                    <img
                      src="https://cdn.midasbuy.com/images/apps/pubgm/1599546030876PIvqwGaa.png"
                      alt="PUBG Mobile"
                      className="w-12 h-12 rounded-lg object-contain bg-transparent"
                    />
                    <div className="flex-1">
                      <h4 className={`font-semibold transition-colors duration-300 ${
                        selectedGames.includes('PUBG_MOBILE') 
                          ? 'bg-gradient-to-r from-orange-600 to-red-600 bg-clip-text text-transparent' 
                          : 'text-gray-900'
                      }`}>PUBG Mobile</h4>
                      <p className="text-sm text-gray-600">Purchase UC for battle royale gaming</p>
                      {selectedGames.includes('PUBG_MOBILE') && (
                        <p className="text-xs text-orange-600 font-medium mt-1">âœ“ Selected for profile completion</p>
                      )}
                    </div>
                  </div>
                </div>

                {/* Mobile Legends Option */}
                <div 
                  onClick={() => {
                    if (selectedGames.includes('MLBB')) {
                      setSelectedGames(selectedGames.filter(game => game !== 'MLBB'))
                    } else {
                      setSelectedGames([...selectedGames, 'MLBB'])
                    }
                  }}
                  className={`cursor-pointer border-2 rounded-xl p-4 transition-all duration-300 hover:shadow-lg transform hover:scale-105 ${
                    selectedGames.includes('MLBB') 
                      ? 'border-purple-500 bg-gradient-to-r from-purple-50 to-pink-50 shadow-lg scale-105' 
                      : 'border-gray-200 hover:border-purple-300 bg-white hover:shadow-md'
                  }`}
                >
                  <div className="flex items-center space-x-3">
                    <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all duration-300 ${
                      selectedGames.includes('MLBB') 
                        ? 'border-purple-500 bg-gradient-to-r from-purple-500 to-pink-500 shadow-lg' 
                        : 'border-gray-300 hover:border-purple-400'
                    }`}>
                      {selectedGames.includes('MLBB') && (
                        <svg className="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                          <path fillRule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clipRule="evenodd" />
                        </svg>
                      )}
                    </div>
                    <img
                      src="https://b4uesports.com/wp-content/uploads/2025/04/1000077486.png"
                      alt="Mobile Legends"
                      className="w-12 h-12 rounded-lg object-cover"
                    />
                    <div className="flex-1">
                      <h4 className={`font-semibold transition-colors duration-300 ${
                        selectedGames.includes('MLBB') 
                          ? 'bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent' 
                          : 'text-gray-900'
                      }`}>Mobile Legends: Bang Bang</h4>
                      <p className="text-sm text-gray-600">Purchase Diamonds for MLBB excellence</p>
                      {selectedGames.includes('MLBB') && (
                        <p className="text-xs text-purple-600 font-medium mt-1">âœ“ Selected for profile completion</p>
                      )}
                    </div>
                  </div>
                </div>
              </div>
              
              {selectedGames.length === 0 && (
                <div className="bg-gradient-to-r from-red-50 to-pink-50 border border-red-200 rounded-lg p-3 mt-4">
                  <p className="text-red-600 text-sm text-center font-medium">ðŸŽ® Please select at least one game to continue your gaming journey!</p>
                </div>
              )}
              
              {selectedGames.length > 0 && (
                <div className="bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-3 mt-4">
                  <p className="text-green-700 text-sm text-center font-medium">
                    ðŸŽ‰ Great! You've selected {selectedGames.length} game{selectedGames.length > 1 ? 's' : ''}. 
                    {selectedGames.length === 1 ? 'Ready to proceed!' : 'You\'ll complete profiles for both games.'}
                  </p>
                </div>
              )}
            </div>
          )}

          {/* Step 3: PUBG Profile */}
          {currentStep === 3 && selectedGames.includes('PUBG_MOBILE') && (
            <div className="space-y-3 sm:space-y-4">
              <h3 className="font-semibold text-gray-900 mb-3 sm:mb-4 text-base sm:text-lg bg-gradient-to-r from-orange-600 to-red-600 bg-clip-text text-transparent">PUBG Mobile Profile</h3>
              <p className="text-sm text-gray-600 mb-3 sm:mb-4">
                Add your PUBG Mobile details to purchase UC packages
              </p>
              
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  IGN (In-Game Name) *
                </label>
                <input
                  type="text"
                  value={pubgData.ign}
                  onChange={(e) => setPubgData({...pubgData, ign: e.target.value})}
                  className="w-full px-3 py-2.5 sm:py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base touch-manipulation bg-gradient-to-r from-orange-50 to-red-50 hover:from-orange-100 hover:to-red-100 transition-all duration-300"
                  placeholder="Your PUBG Mobile username"
                />
                {errors.pubgIgn && <p className="text-red-500 text-sm mt-1">{errors.pubgIgn}</p>}
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  UID (User ID) *
                </label>
                <input
                  type="text"
                  value={pubgData.uid}
                  onChange={(e) => setPubgData({...pubgData, uid: e.target.value.replace(/\D/g, '')})}
                  className="w-full px-3 py-2.5 sm:py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base touch-manipulation bg-gradient-to-r from-orange-50 to-red-50 hover:from-orange-100 hover:to-red-100 transition-all duration-300"
                  placeholder="123456789"
                />
                {errors.pubgUid && <p className="text-red-500 text-sm mt-1">{errors.pubgUid}</p>}
                <p className="text-xs text-gray-500 mt-1">
                  Find your UID in PUBG Mobile settings
                </p>
              </div>
            </div>
          )}

          {/* Step 4: MLBB Profile */}
          {currentStep === 4 && selectedGames.includes('MLBB') && (
            <div className="space-y-3 sm:space-y-4">
              <h3 className="font-semibold text-gray-900 mb-3 sm:mb-4 text-base sm:text-lg bg-gradient-to-r from-pink-600 to-purple-600 bg-clip-text text-transparent">Mobile Legends Profile</h3>
              <p className="text-sm text-gray-600 mb-3 sm:mb-4">
                Add your Mobile Legends details to purchase Diamond packages
              </p>
              
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  User ID *
                </label>
                <input
                  type="text"
                  value={mlbbData.userId_game}
                  onChange={(e) => setMlbbData({...mlbbData, userId_game: e.target.value.replace(/\D/g, '')})}
                  className="w-full px-3 py-2.5 sm:py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm sm:text-base touch-manipulation bg-gradient-to-r from-pink-50 to-purple-50 hover:from-pink-100 hover:to-purple-100 transition-all duration-300"
                  placeholder="123456789"
                />
                {errors.mlbbUserId && <p className="text-red-500 text-sm mt-1">{errors.mlbbUserId}</p>}
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  Zone ID *
                </label>
                <input
                  type="text"
                  value={mlbbData.zoneId}
                  onChange={(e) => setMlbbData({...mlbbData, zoneId: e.target.value.replace(/\D/g, '')})}
                  className="w-full px-3 py-2.5 sm:py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm sm:text-base touch-manipulation bg-gradient-to-r from-pink-50 to-purple-50 hover:from-pink-100 hover:to-purple-100 transition-all duration-300"
                  placeholder="1234"
                />
                {errors.mlbbZoneId && <p className="text-red-500 text-sm mt-1">{errors.mlbbZoneId}</p>}
                <p className="text-xs text-gray-500 mt-1">
                  Find User ID and Zone ID in Mobile Legends profile
                </p>
              </div>
            </div>
          )}

          {/* Actions */}
          <div className="flex space-x-2 sm:space-x-3 mt-4 sm:mt-6">
            {currentStep > 1 && (
              <button
                onClick={handleBack}
                className="flex-1 px-3 py-2.5 sm:px-4 sm:py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 text-sm sm:text-base touch-manipulation active:scale-95 transition-all duration-300"
              >
                Back
              </button>
            )}
            
            {/* Next button logic */}
            {currentStep === 1 && (
              <button
                onClick={handleNext}
                className="flex-1 px-3 py-2.5 sm:px-4 sm:py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm sm:text-base touch-manipulation active:scale-95 transition-all duration-300"
              >
                Next
              </button>
            )}
            
            {/* Game selection step */}
            {currentStep === 2 && (
              <button
                onClick={handleNext}
                disabled={selectedGames.length === 0}
                className="flex-1 px-3 py-2.5 sm:px-4 sm:py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed text-sm sm:text-base touch-manipulation active:scale-95 transition-all duration-300"
              >
                Continue
              </button>
            )}
            
            {/* PUBG Profile step */}
            {currentStep === 3 && selectedGames.includes('PUBG_MOBILE') && (
              selectedGames.includes('MLBB') ? (
                <button
                  onClick={handleNext}
                  className="flex-1 px-3 py-2.5 sm:px-4 sm:py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 text-sm sm:text-base touch-manipulation active:scale-95 transition-all duration-300"
                >
                  Next: MLBB Profile
                </button>
              ) : (
                <button
                  onClick={handleSubmit}
                  disabled={isLoading}
                  className="flex-1 px-3 py-2.5 sm:px-4 sm:py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 text-sm sm:text-base touch-manipulation active:scale-95 transition-all duration-300"
                >
                  {isLoading ? 'Saving...' : 'Complete Profile'}
                </button>
              )
            )}
            
            {/* MLBB Profile step - final step */}
            {currentStep === 4 && selectedGames.includes('MLBB') && (
              <button
                onClick={handleSubmit}
                disabled={isLoading}
                className="flex-1 px-3 py-2.5 sm:px-4 sm:py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 text-sm sm:text-base touch-manipulation active:scale-95 transition-all duration-300"
              >
                {isLoading ? 'Saving...' : 'Complete Profile'}
              </button>
            )}
          </div>
        </div>
      </div>
    </div>
  )
}